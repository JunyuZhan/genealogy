# 开发计划与待办清单

## 任务受领与状态规则
- 参与开发的工程师必须先受领任务
- 受领后将任务标注为 `进行中 - 你的名字`
- 完成后将任务标记为 `已完成 - 你的名字`

### 标注格式示例
```markdown
- [ ] 1.1 明确需求范围与优先级
- [~] 1.2 冻结核心数据模型 (进行中 - 张三)
- [x] 1.3 明确技术栈 (已完成 - 李四)
```

## P0：门户页面与用户体系 (1周)
- [ ] 0.1 门户首页设计
    - [ ] 0.1.1 顶部：Logo + 系统名称 + 导航菜单
    - [ ] 0.1.2 Banner：家族全称 + 简介 + 祖训/家训
    - [ ] 0.1.3 功能入口：族谱浏览、祭扫纪念（图标+按钮）
    - [ ] 0.1.4 支系入口：支系卡片列表展示
    - [ ] 0.1.5 统计概览：家族人口（已故/在世）、支系数量、祭扫次数
    - [ ] 0.1.6 最新动态：最近祭扫记录、最新成员、公告通知
    - [ ] 0.1.7 底部：版权信息、联系方式、管理员登录入口
- [ ] 0.2 公告/动态模块
- [ ] 0.3 捐赠功能（维护网站运营）
    - [ ] 0.3.1 随喜捐赠入口（微信/支付宝）
    - [ ] 0.3.2 捐赠人信息：姓名、金额（必填公开）
    - [ ] 0.3.3 捐赠意愿选择：网站运营、宗族互助、专项基金等
    - [ ] 0.3.4 捐赠名单与金额公示
    - [ ] 0.3.5 捐赠用途公示与明细
- [ ] 0.4 宗族互助倡议功能
    - [ ] 0.4.1 倡议发布（家庭困难、考学奖励、突发灾难等）
    - [ ] 0.4.2 自愿认捐
    - [ ] 0.4.3 倡议进度展示
    - [ ] 0.4.4 倡议公示透明
    - [ ] 0.4.5 公益事项开放参与（捐赠、倡议、祭扫无需登录即可参与）
- [ ] 0.5 用户注册（手机号/邮箱+密码，可选实名）
- [ ] 0.6 用户登录
- [ ] 0.7 角色体系：超级管理员、家族管理员、支系联系人、普通成员、访客
- [ ] 0.8 角色分配逻辑
    - 普通成员：注册自动成为（无需审核）
    - 支系联系人：需管理员审批
    - 管理员：需上级分配
- [ ] 0.9 支系联系人管理（分配支系、查看负责范围）
- [ ] 0.10 信息收集申请流程（支系联系人发起 → 管理员审核 → 生效）
- [ ] 0.11 信息审批流程（管理员审核）
- [ ] 0.12 支系介绍页面（支系名称、始祖、简介、人口统计、迁居地）
- [ ] 0.13 批量信息导入模板

## P1：启动与核心骨架 (1周)
- [ ] 1.1 明确需求范围与优先级
- [ ] 1.2 冻结核心数据模型与字段命名
- [ ] 1.3 明确第一阶段技术栈与地图服务方案
- [ ] 1.4 明确分支协作与评审规范
- [x] 1.5 初始化前端项目 (Vue3 + Vite + Tailwind) (已完成 - Gemini)
- [x] 1.6 搭建基础路由与页面骨架 (已完成 - Gemini)
- [x] 1.7 建立 TypeScript 类型定义 (已完成 - Gemini)
- [x] 1.8 创建 Mock 数据生成器 (5代家族数据) (已完成 - Gemini)
- [x] 1.9 建立 Pinia 状态管理 (已完成 - Gemini)
- [x] 1.10 设计并创建 PostgreSQL 数据库表结构 (已完成 - minimax)
- [x] 1.11 建立后端 API 基础架构 (已完成 - minimax)

## P2：族谱树核心功能 (2-3周)
- [x] 2.1 D3.js 树形布局基础实现 (已完成 - Gemini)
- [x] 2.2 TreeNode 组件：显示姓名 + 配偶 (已完成 - Gemini)
- [x] 2.3 点击展开/收起交互 (已完成 - Gemini)
- [x] 2.4 代际对齐逻辑 (同代同 Y 轴) (已完成 - Gemini)
- [x] 2.5 节点样式：男女配色、生死状态区分 (已完成 - Gemini)
- [ ] 2.6 节点详情侧边栏
- [ ] 2.7 独立支系管理（无父节点成员侧边栏列表）
- [ ] 2.8 拖拽归入主树功能
- [ ] 2.9 支系合并功能
- [ ] 2.10 支系合并冲突处理（重名、代际矛盾）
- [ ] 2.11 合并操作日志记录

## P3：数据增删改 (2周)
- [x] 3.1 右键/点击菜单组件 (已完成 - Gemini)
- [x] 3.2 添加子辈 (已完成 - Gemini)
- [x] 3.3 添加父辈（含代际重算） (已完成 - Gemini)
- [x] 3.4 添加配偶 (已完成 - Gemini)
- [ ] 3.5 添加兄弟
- [ ] 3.6 编辑/删除成员 (部分完成)
- [ ] 3.7 数据校验逻辑
- [x] 3.8 信息录入流程（支系联系人发起 → 管理员审核 → 生效）(已在API中实现)
- [x] 3.9 成员状态变更（在世→去世）：知情人发起 → 管理员审核 → 生效 (已完成 - minimax)
- [x] 3.10 状态变更后自动启用祭扫功能 (已完成 - minimax)
- [x] 3.11 管理员紧急直接修改（带操作日志）(已完成 - minimax)

## P4：搜索与路径 (1周)
- [ ] 4.1 全局搜索组件
- [ ] 4.2 搜索结果自动溯源展开
- [ ] 4.3 路径高亮动画
- [x] 4.4 农历日期模糊匹配（如 "乾隆五十年"）(已完成 - minimax)
- [x] 4.5 字辈索引搜索 (已完成 - minimax)

## P5：权限、隐私与数据管理 (2周)

### 5.1 隐私控制
- [x] 5.1.1 信息分类：公开信息 vs 可选公开信息 (已完成 - minimax)
- [x] 5.1.2 公开信息字段：姓名、世代、字辈、墓穴位置、已故状态 (已完成 - minimax)
- [x] 5.1.3 可选公开字段：生卒日期、配偶、照片、祭扫记录、联系方式、详细生平 (已完成 - minimax)
- [x] 5.1.4 在世成员默认隐藏（可手动开启公开） (已完成 - minimax)
- [x] 5.1.5 已故成员默认公开（可设置部分隐藏） (已完成 - minimax)
- [ ] 5.1.6 用户授权界面：勾选哪些字段对外可见
- [ ] 5.1.7 授权撤回功能
- [x] 5.1.8 导出时自动过滤涉密信息 (已完成 - minimax)

### 5.2 权限管理
- [x] 5.2.1 访客模式（只读查看公开信息） (已完成 - minimax)
- [x] 5.2.2 用户注册与登录 (已完成 - minimax)
- [x] 5.2.3 成员本人查看/编辑自己资料 (已完成 - minimax)
- [x] 5.2.4 编辑权限控制（需管理员审批） (已完成 - minimax)
- [x] 5.2.5 操作日志记录与查看 (已完成 - minimax)

### 5.3 数据管理
- [x] 5.3.1 数据自动备份 (已完成 - minimax)
- [x] 5.3.2 JSON/SQL 手动导出 (已完成 - minimax)
- [x] 5.3.3 CSV/Excel 批量导入 (已完成 - minimax)

### 5.4 后台配置管理（所有变量均在后端配置）
- [ ] 5.4.1 系统参数配置（系统名称、Logo、描述）
- [ ] 5.4.2 隐私策略默认配置（后台统一设置）
- [ ] 5.4.3 角色权限配置（后台管理各角色功能开关）
- [ ] 5.4.4 祭扫功能开关（后台统一开启/关闭）
- [ ] 5.4.5 地图服务配置（API Key、默认中心点）
- [ ] 5.4.6 世系表样式配置（排版默认模式）
- [ ] 5.4.7 门户页面配置（公告、首页展示内容）
- [ ] 5.4.8 导入模板配置（字段映射、必填项）

## P6：地图功能 (2周)
- [x] 6.1 Leaflet 地图集成 (已完成 - Gemini)
- [x] 6.2 成员详情页地图展示 (已完成 - Gemini)
- [x] 6.3 地图选点 + 逆地理编码 (已完成 - Gemini)
- [ ] 6.4 墓冢相册上传（任何人可发起）
- [ ] 6.5 墓冢360度全景影像上传与预览（如 pannellum）
- [ ] 6.6 墓冢照片/全景审核流程（支系联系人/管理员审核后公开）
- [ ] 6.7 手机导航二维码

## P7：祭扫功能 (1周)

### P7：在线祭扫 (2周)
- [x] 7.1.1 成员详情页祭扫入口（已故成员右上角"祭扫"按钮）(已完成 - Gemini)
- [x] 7.1.2 祭扫纪念独立页面（可选择成员）(已完成 - Gemini)
- [x] 7.1.3 祭扫地图（在地图上直接点击墓冢祭扫）(已完成 - Gemini)
- [x] 7.1.4 祭扫虚拟场景展示（祠堂/墓地背景、祖先遗像）(已完成 - Gemini)
- [x] 7.2.1 献花：虚拟花束递送动画 + 音效 (已完成 - Gemini)
- [x] 7.2.2 点烛：蜡烛点燃闪烁动画 + 背景音乐（可选）(已完成 - Gemini)
- [x] 7.2.3 上香：香烟袅袅上升动画 (已完成 - Gemini)
- [x] 7.2.4 留言：文字输入，显示在纪念墙 (已完成 - Gemini)
- [x] 7.2.5 祭扫特效：花瓣飘落、烛光摇跃、烟雾上升 (已完成 - Gemini)

### 7.3 祭扫记录与统计
- [x] 7.3.1 祭扫日志记录（谁、何时、做了什么）(已完成 - Gemini)
- [x] 7.3.2 祭扫统计展示（祭扫人数、最后祭扫时间）(已完成 - Gemini)
- [x] 7.3.3 纪念墙展示（匿名显示留言）(已完成 - Gemini)
- [x] 7.3.4 在线状态显示（"XX人正在祭扫"）(已完成 - Gemini)

### 7.4 祭扫提醒
- [x] 7.4.1 新祭扫实时推送通知 (已完成 - Gemini)
- [x] 7.4.2 祭扫纪念日提醒 (已完成 - Gemini)

## P8：世系表视图 (1周)
- [ ] 8.1 欧式排版
- [ ] 8.2 苏式排版
- [ ] 8.3 字辈索引功能
- [ ] 8.4 配偶合并显示

## P9：导出与发布 (1周)
- [ ] 9.1 族谱树导出 PNG/JPG
- [ ] 9.2 PDF 族谱书
- [ ] 9.3 GEDCOM 格式导入/导出
- [ ] 9.4 移动端触摸手势优化
- [ ] 9.5 响应式布局适配

### 9.6 安全保障
- [ ] 9.6.1 HTTPS 全站加密传输
- [ ] 9.6.2 DDOS 防护与 CDN 接入
- [ ] 9.6.3 请求限流（防止恶意攻击）
- [ ] 9.6.4 输入验证（防止 SQL 注入、XSS）
- [ ] 9.6.5 验证码（注册/登录/敏感操作）
- [ ] 9.6.6 密码加密存储（bcrypt/argon2）
- [ ] 9.6.7 登录限制（多次失败锁定）
- [ ] 9.6.8 Token 过期与刷新机制
- [ ] 9.6.9 定期数据备份（多地备份）
- [ ] 9.6.10 操作日志记录
- [ ] 9.6.11 实时监控与异常告警
- [ ] 9.6.12 应急响应机制
- [ ] 9.6.13 安全审计与定期检查

- [ ] 9.7 性能优化与监控
- [ ] 9.8 部署配置与上线
